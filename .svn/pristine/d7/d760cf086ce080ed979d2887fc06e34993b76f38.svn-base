<!-- BEGIN PAGE HEADER-->
<div class="page-bar">
    <h3 class="page-title pull-left" ng-if="!vm.entry.id"><i class="im im-icon-Add-User margin-right-5"></i> Thêm mới một bệnh nhân</h3>
    <h3 class="page-title pull-left" ng-if="vm.entry.id"><i class="im im-icon-Checked-User margin-right-5"></i> Cập nhật thông tin bệnh nhân</h3>
    <ul class="page-breadcrumb pull-right hidden-xs">
        <li>
            <a href="#">Trang chủ</a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <a href="#/opc/patients">Phòng khám ngoại trú</a>
        </li>
    </ul>
</div>
<!-- END PAGE HEADER-->
<!-- BEGIN MAIN CONTENT -->
<div class="row margin-top-10">
    <div class="col-md-12">
        <div class="portlet light bordered">
            <div class="portlet-body" id="sticky-container">
                <div class="display-block no-content1 margin-top-10" ng-if="!isSiteManager(currentUser)">
                    Bạn không có quyền xem nội dung này.
                </div>
                <div class="row" ng-if="isSiteManager(currentUser)">
                    <div class="col-xs-12">
                        <div class="tabbable-line">
                            <ul class="nav nav-tabs ">
                                <li class="uppercase">
                                    <a href="#/opc-dashboard" uib-tooltip="Tổng quan"><i class="fa fa-area-chart"></i><span class="hidden-xs" ng-class="{'hidden-sm' : isSiteManager(currentUser) || (vm.selectedEntry && vm.selectedEntry.theCase)}"> Tổng quan</span></a>
                                </li>
                                <li class="uppercase">
                                    <a href="#/opc/patients" uib-tooltip="Quản&nbsp;lý bệnh&nbsp;nhân"><i class="fa fa-wheelchair-alt"></i><span class="hidden-xs hidden-sm hidden-md"> Bệnh nhân</span></a>
                                </li>
                                <li class="uppercase" ng-if="isSiteManager(currentUser)">
                                    <a href="#/opc/appointment-cal/edit" uib-tooltip="Khám&nbsp;bệnh&nbsp;-&nbsp;Cấp&nbsp;thuốc"><i class="icon-calendar"></i><span class="hidden-xs"> Lịch khám </span></a>
                                    <!--<span class="tab-new-function"><i class="fa fa-flash"></i> mới</span>-->
                                </li>
                                <li class="uppercase">
                                    <a href="#/opc/report" uib-tooltip="Báo&nbsp;cáo"><i class="fa fa-bar-chart"></i><span class="hidden-xs"> Báo cáo</span></a>
                                </li>
                                <li class="uppercase" ng-if="vm.selectedEntry && vm.selectedEntry.theCase.person && vm.selectedEntry.theCase.person.id">
                                    <a uib-tooltip="Thông&nbsp;tin&nbsp;bệnh&nbsp;nhân" href="#/opc/view-patient/{{vm.selectedEntry.id}}"><i class="fa {{vm.selectedEntry.theCase.person.genderIcon}}"></i> {{vm.selectedEntry.theCase.person.fullname}} ({{vm.selectedEntry.theCase.person.age}} tuổi)</a>
                                </li>
                                <li class="active uppercase">
                                    <a href="#" ng-if="!vm.entry.id"><i class="icon-pencil"></i> {{!vm.entry.theCase.person.fullname ? 'Bệnh nhân mới' : vm.entry.theCase.person.fullname}}</a>
                                    <a href="#" ng-if="vm.entry.id"><i class="icon-pencil"></i> {{vm.entry.theCase.person.fullname}}</a>
                                </li>
                            </ul>
                            <div class="tab-content summary-panel">
                                <div class="tab-pane active">
                                    <div class="opc-toolbar margin-bottom-10 sticky-panel" hl-sticky="" container="sticky-container" sticky-class="is-sticky custom-alt-2">
                                        <div>
                                            <div class="input-group-btn">
                                                <button class="btn btn-primary no-border margin-left-10" data-ng-disabled="!vm.entry.editable || vm.submitDisabled" ng-click="vm.savePatient({redirect: 1});" uib-tooltip="Lưu thông tin bệnh nhân" tooltip-placement="auto"><i class="fa fa-check"></i> Lưu thay đổi</button>
                                                <button type="button" class="btn btn-primary no-border dropdown-toggle" data-ng-disabled="!vm.entry.editable" data-toggle="dropdown" tabindex="-1">
                                                    <i class="fa fa-angle-down"></i>
                                                </button>
                                                <ul class="dropdown-menu" role="menu">
                                                    <li>
                                                        <a href="#" class="bold" ng-click="vm.savePatient({redirect: 2});"><i class="im im-icon-Add-User margin-right-10"></i> Lưu và thêm bệnh nhân mới </a>
                                                    </li>
                                                    <li class="divider"> </li>
                                                    <li>
                                                        <a href="#" class="bold" ng-click="vm.savePatient({redirect: 3});"><i class="icon-list margin-right-10"></i> Lưu và trở về danh sách </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="vertical-seperator"></div>
                                        <button class="btn btn-default no-border" ng-click="vm.closeEditForm(true);" uib-tooltip="Thoát khỏi màn hình nhập liệu" tooltip-placement="auto"><i class="fa fa-close"></i> Đóng lại</button>
                                        <div class="vertical-seperator"></div>
                                        <button class="btn btn-default no-border font-weight-500 text-muted" ng-click="vm.showEntryGuide();" g uib-tooltip="Hướng dẫn nhập liệu" tooltip-placement="auto"><i class="fa fa-street-view margin-right-5"></i><span class="hidden-xs"> Hướng dẫn nhập liệu</span></button>
                                        <!--<div class="warning-box loading-button hidden-sm hidden-xs" ng-if="!vm.entry.id" ng-cloak=""><i class="fa fa-warning"></i><span> Hồ sơ bệnh nhân này chưa được lưu vào cơ sở dữ liệu.</span></div>-->
                                    </div>
                                    <div class="summary-panel padding-left-20 padding-right-20 padding-bottom-30">
                                        <div class="section-head with-background-1 bold"><i class="im im-icon-Add-User color-7"></i> Thông tin chung</div>
                                        <div class="row">
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="bold">Cơ sở điều trị</label>
                                                <ui-select id="vm.entry.organization" data-ng-disabled="vm.entry.id" ng-model="vm.entry.organization" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                    <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                                    <ui-select-choices repeat="org in vm.opcs | propsFilter: {name: $select.search}">
                                                        <div class="bold" ng-bind-html="org.name | highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="bold">Họ tên bệnh nhân</label>
                                                <input class="form-control" autocomplete="off" title-case="" ng-model="vm.entry.theCase.person.fullname" id="vm.entry.theCase.person.fullname" />
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="bold">Ngày sinh</label>
                                                <input id="vm.entry.theCase.person.dob" class="form-control" placeholder="Chọn ngày..."
                                                       ng-flatpickr
                                                       fp-opts="vm.datepicker1.dateOpts"
                                                       fp-on-setup="vm.datepicker1.datePostSetup(fpItem)"
                                                       ng-model="vm.entry.theCase.person.dob"
                                                       data-enabletime="false" />
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="bold">Giới tính</label>
                                                <ui-select id="vm.entry.theCase.person.gender" ng-model="vm.entry.theCase.person.gender" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                    <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                                    <ui-select-choices repeat="gender.id as gender in vm.genders | propsFilter: {name: $select.search}">
                                                        <div class="bold" ng-bind-html="gender.name | highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px" ng-if="!vm.entry.hivInfoIdLocked">
                                                <label class="underline font-weight-500" uib-tooltip="Nhập khi có thông tin"><i class="icon-muted fa fa-anchor margin-right-10"></i> Mã HIVInfo</label>
                                                <input class="form-control with-inline-icon" double-entry callback="vm.confirmHIVInfoId();" id="vm.entry.theCase.hivInfoId" ng-model="vm.entry.theCase.hivInfoId" input-mask="99999999999999999999" maxlength="20" />
                                                <i class="fa fa-heartbeat"></i>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px" ng-if="vm.entry.hivInfoIdLocked">
                                                <label class="underline font-weight-500" uib-tooltip="Tỉnh đã khóa sửa mã HIVInfo"><i class="icon-muted fa fa-lock margin-right-10"></i> Mã HIVInfo</label>
                                                <span class="form-control read-only-bg"><i class="fa fa-heartbeat margin-right-10 icon-muted"></i>{{vm.entry.theCase.hivInfoId}}</span>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="font-weight-500">Số CMTND/CCCD</label>
                                                <input class="form-control with-inline-icon" id="vm.entry.theCase.person.nidNumber" ng-model="vm.entry.theCase.person.nidNumber" maxlength="20" />
                                                <i class="fa fa-id-card"></i>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="font-weight-500">Điện thoại liên lạc</label>
                                                <input class="form-control with-inline-icon" ng-model="vm.entry.theCase.person.mobilePhone" maxlength="20" />
                                                <i class="fa fa-phone"></i>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="font-weight-500">Dân tộc</label>
                                                <ui-select id="vm.entry.theCase.person.ethnic" ng-model="vm.entry.theCase.person.ethnic" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                    <ui-select-match allow-clear="true" placeholder="Xin mời chọn...">{{$select.selected.value}}</ui-select-match>
                                                    <ui-select-choices repeat="ethnic in vm.ethnics | filter: {value: $select.search}">
                                                        <div class="bold" ng-bind-html="ethnic.value | highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="font-weight-500">Nghề nghiệp</label>
                                                <ui-select id="vm.entry.theCase.person.occupation" ng-model="vm.entry.theCase.person.occupation" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                    <ui-select-match allow-clear="true" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                                    <ui-select-choices repeat="f.id as f in vm.occupations | filter: {name: $select.search}">
                                                        <div class="bold" ng-bind-html="f.name | highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px">
                                                <label class="font-weight-500" ng-class="{'text-muted mutter' : vm.entry.theCase.person.occupation != 9}">Ghi rõ tên nghề khác</label>
                                                <input id="vm.entry.theCase.person.occupationName" class="form-control" ng-model="vm.entry.theCase.person.occupationName" ng-disabled="vm.entry.theCase.person.occupation != 9"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <div class="section-head with-background-1 bold"><i class="im im-icon-Map-Marker2 color-7"></i> Địa chỉ hiện tại</div>
                                                <div class="row">
                                                    <div class="col-sm-6 margin-top-20">
                                                        <label class="bold">Tỉnh/thành phố</label>
                                                        <ui-select id="vm.caseAddress.currentAddress.province" ng-model="vm.caseAddress.currentAddress.province" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                            <ui-select-match allow-clear="false" placeholder="Chọn tỉnh...">{{$select.selected.name}}</ui-select-match>
                                                            <ui-select-choices repeat="province in vm.addressFilter1.provinces | propsFilter: {name: $select.search}">
                                                                <div class="bold" ng-bind-html="province.name | highlight: $select.search"></div>
                                                            </ui-select-choices>
                                                        </ui-select>
                                                    </div>
                                                    <div class="col-sm-6 margin-top-20">
                                                        <label class="bold">Huyện/quận</label>
                                                        <ui-select id="vm.caseAddress.currentAddress.district" ng-model="vm.caseAddress.currentAddress.district" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                            <ui-select-match allow-clear="false" placeholder="{{vm.caseAddress.currentAddress.province && vm.caseAddress.currentAddress.province.id ? 'Chọn huyện...' : 'Chọn tỉnh trước...'}}">{{$select.selected.name}}</ui-select-match>
                                                            <ui-select-choices repeat="district in vm.addressFilter1.districts | propsFilter: {name: $select.search}">
                                                                <div class="bold" ng-bind-html="district.name | highlight: $select.search"></div>
                                                            </ui-select-choices>
                                                        </ui-select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-6 margin-top-20">
                                                        <label class="font-weight-500">Xã/phường</label>
                                                        <ui-select ng-model="vm.caseAddress.currentAddress.commune" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                            <ui-select-match allow-clear="true" placeholder="{{vm.caseAddress.currentAddress.district && vm.caseAddress.currentAddress.district.id ? 'Chọn xã...' : 'Chọn huyện trước...'}}">{{$select.selected.name}}</ui-select-match>
                                                            <ui-select-choices repeat="commune in vm.addressFilter1.communes | propsFilter: {name: $select.search}">
                                                                <div class="bold" ng-bind-html="commune.name | highlight: $select.search"></div>
                                                            </ui-select-choices>
                                                        </ui-select>
                                                    </div>
                                                    <div class="col-sm-6 margin-top-20">
                                                        <label class="font-weight-500">Thôn bản/số nhà</label>
                                                        <input class="form-control" ng-model="vm.caseAddress.currentAddress.streetAddress" />
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-xs-12 margin-top-20">
                                                        <div class="md-checkbox">
                                                            <input type="checkbox" id="chk_same_address_alt" ng-model="vm.entry.theCase.sameAddress" class="md-check">
                                                            <label class="font-weight-600" for="chk_same_address_alt">
                                                                <span></span>
                                                                <span class="check"></span>
                                                                <span class="box"></span> Địa chỉ hiện tại trùng với địa chỉ thường trú?
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="section-head with-background-1 bold"><i class="im im-icon-Map-Marker2 color-7"></i> Địa chỉ thường trú</div>
                                                <div class="row">
                                                    <div class="col-sm-6 margin-top-20">
                                                        <label class="bold">Tỉnh/thành phố</label>
                                                        <ui-select ng-disabled="vm.entry.theCase.sameAddress" id="vm.caseAddress.residentAddress.province" ng-model="vm.caseAddress.residentAddress.province" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                            <ui-select-match allow-clear="false" placeholder="Chọn tỉnh...">{{$select.selected.name}}</ui-select-match>
                                                            <ui-select-choices repeat="province in vm.addressFilter2.provinces | propsFilter: {name: $select.search}">
                                                                <div class="bold" ng-bind-html="province.name | highlight: $select.search"></div>
                                                            </ui-select-choices>
                                                        </ui-select>
                                                    </div>
                                                    <div class="col-sm-6 margin-top-20">
                                                        <label class="bold">Huyện/quận</label>
                                                        <ui-select ng-disabled="vm.entry.theCase.sameAddress" id="vm.caseAddress.residentAddress.district" ng-model="vm.caseAddress.residentAddress.district" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                            <ui-select-match allow-clear="false" placeholder="{{vm.caseAddress.residentAddress.province && vm.caseAddress.residentAddress.province.id ? 'Chọn huyện...' : 'Chọn tỉnh trước...'}}">{{$select.selected.name}}</ui-select-match>
                                                            <ui-select-choices repeat="district in vm.addressFilter2.districts | propsFilter: {name: $select.search}">
                                                                <div class="bold" ng-bind-html="district.name | highlight: $select.search"></div>
                                                            </ui-select-choices>
                                                        </ui-select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-sm-6 margin-top-20">
                                                        <label class="font-weight-500">Xã/phường</label>
                                                        <ui-select data-ng-disabled="vm.entry.theCase.sameAddress" ng-model="vm.caseAddress.residentAddress.commune" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                            <ui-select-match allow-clear="true" placeholder="{{vm.caseAddress.residentAddress.district && vm.caseAddress.residentAddress.district.id ? 'Chọn xã...' : 'Chọn huyện trước...'}}">{{$select.selected.name}}</ui-select-match>
                                                            <ui-select-choices repeat="commune in vm.addressFilter2.communes | propsFilter: {name: $select.search}">
                                                                <div class="bold" ng-bind-html="commune.name | highlight: $select.search"></div>
                                                            </ui-select-choices>
                                                        </ui-select>
                                                    </div>
                                                    <div class="col-sm-6 margin-top-20">
                                                        <label class="font-weight-500">Thôn bản/số nhà</label>
                                                        <input class="form-control" ng-disabled="vm.entry.theCase.sameAddress" ng-model="vm.caseAddress.residentAddress.streetAddress" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section-head with-background-1 bold"><i class="pdma-ext1-icon-lab color-7"></i> Thông tin xét nghiệm chẩn đoán HIV</div>
                                        <div class="row">
                                            <div class="col-lg-3 col-sm-6 margin-top-20">
                                                <label class="underline font-weight-500" uib-tooltip="Nhập nếu có thông tin"><i class="icon-muted fa fa-bar-chart margin-right-10"></i>Ngày lấy mẫu/XN s.lọc HIV+</label>
                                                <input id="vm.entry.theCase.hivScreenDate" class="form-control" placeholder="Chọn ngày..."
                                                       ng-flatpickr
                                                       fp-opts="vm.datepicker6.dateOpts"
                                                       fp-on-setup="vm.datepicker6.datePostSetup(fpItem)"
                                                       ng-model="vm.entry.theCase.hivScreenDate"
                                                       data-enabletime="false" />
                                            </div>
                                            <div class="col-lg-3 col-sm-6 margin-top-20">
                                                <label class="bold">Ngày XN khẳng định HIV+</label>
                                                <input id="vm.entry.theCase.hivConfirmDate" class="form-control" placeholder="Chọn ngày..."
                                                       ng-flatpickr
                                                       fp-opts="vm.datepicker2.dateOpts"
                                                       fp-on-setup="vm.datepicker2.datePostSetup(fpItem)"
                                                       ng-model="vm.entry.theCase.hivConfirmDate"
                                                       data-enabletime="false" />
                                            </div>
                                            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 margin-top-20">
                                                <label class="font-weight-500">Cơ sở XN khẳng định HIV+</label>
                                                <ui-select allow-free-text="true" ng-model="vm.entry.theCase.confirmLab" ng-change="vm.onConfirmLabChange()" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                    <ui-select-match allow-clear="true" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                                    <ui-select-choices ui-disable-choice="$index == 1" repeat="lab in vm.confirmLabs | propsFilter: {name: $select.search}">
                                                        <div ng-if="$index != 1" ng-class="{'bold' : $index != 1}" ng-bind-html="lab.name | highlight: $select.search"></div>
                                                        <hr class="small-margin" ng-if="$index == 1" />
                                                        <div ng-bind-html="lab.address.province.name | highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                            </div>
                                            <div class="col-lg-12 col-md-6 col-sm-12 col-xs-12 margin-top-20" ng-if="vm.entry.theCase.confirmLab && vm.entry.theCase.confirmLab.id == 0">
                                                <label ng-class="{'text-muted mutter' : !vm.entry.theCase.confirmLab || vm.entry.theCase.confirmLab.id > 0}">Tên cơ sở xét nghiệm khác</label>
                                                <input class="form-control" placeholder="Nhập tên cơ sở XN khẳng định" ng-disabled="!vm.entry.theCase.confirmLab || vm.entry.theCase.confirmLab.id > 0" ng-model="vm.entry.theCase.confirmLabName" id="vm.entry.theCase.confirmLabName" />
                                            </div>
                                        </div>
                                        <div class="section-head with-background-1 bold"><i class="pdma-ext1-icon-pills-2 color-7"></i> Thông tin điều trị bằng thuốc ARV</div>
                                        <div class="row">
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20">
                                                <!--<label class="bold">Tình trạng điều trị ARV</label>-->
                                                <div class="md-checkbox margin-top-20">
                                                    <input type="checkbox" id="chk_arv_status" ng-change="vm.onArvTxStatusChange()" ng-model="vm.entry.theCase.onArv" class="md-check">
                                                    <label class="font-weight-500" for="chk_arv_status">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span> Bệnh nhân đã điều trị ARV
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20">
                                                <label class="bold" ng-class="{'text-muted mutter' : vm.entry.theCase.notOnArv}">Ngày bắt đầu điều trị ARV</label>
                                                <span class="form-control read-only-bg" ng-if="!vm.entry.theCase.onArv">{{vm.entry.arvStartDate | date:'dd/MM/yyyy'}}</span>
                                                <input id="vm.entry.theCase.arvStartDate" ng-if="vm.entry.theCase.onArv" class="form-control" placeholder="Chọn ngày..."
                                                       ng-flatpickr
                                                       fp-opts="vm.datepicker3.dateOpts"
                                                       fp-on-setup="vm.datepicker3.datePostSetup(fpItem)"
                                                       ng-model="vm.entry.theCase.arvStartDate"
                                                       data-enabletime="false" />
                                            </div>
                                            <div class="col-lg-6 hidden-md hidden-sm hidden-xs margin-top-20">
                                                <label class="margin-top-20"><i class="fa fa-caret-left margin-right-5"></i>Là ngày đầu tiên mà bệnh nhân được nhận ARV sau khi có kết quả khẳng định HIV+.</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-12 margin-top-20">
                                                <div class="underline-alt bold padding-bottom-5"><i class="fa fa-caret-down margin-right-5"></i>Phác đồ thuốc ARV gần đây nhất của bệnh nhân</div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-3 col-sm-6 margin-top-20">
                                                <label class="bold" ng-class="{'text-muted mutter' : !vm.entry.theCase.onArv}">Phác đồ thuốc ARV</label>
                                                <span ng-if="!vm.entry.theCase.onArv || !vm.entry.theCase.arvDataEditable" class="form-control read-only-bg">{{vm.entry.theCase.currentArvRegimenName ? vm.entry.theCase.currentArvRegimenName : ''}}</span>
                                                <ui-select ng-if="vm.entry.theCase.onArv && vm.entry.theCase.arvDataEditable" id="vm.entry.theCase.currentArvRegimen" ng-model="vm.entry.theCase.currentArvRegimen" ng-change="vm.onCurrentRegimenChange()" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                    <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">
                                                        {{$select.selected.name}}
                                                    </ui-select-match>
                                                    <ui-select-choices ui-disable-choice="$index == 1" repeat="regimen in vm.regimens | drugsFilter: {name: $select.search}">
                                                        <div class="bold" ng-if="$index != 1" ng-bind-html="regimen.name | highlight: $select.search"></div>
                                                        <hr class="small-margin" ng-if="$index == 1" />
                                                        <div ng-if="$index > 1" ng-bind-html="'Phác đồ bậc ' + regimen.line"></div>
                                                        <div ng-if="$index == 0" ng-bind-html="regimen.description"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                            </div>
                                            <div class="col-lg-3 col-sm-6  margin-top-20">
                                                <label ng-class="{'bold' : vm.entry.theCase.currentArvRegimen && vm.entry.theCase.currentArvRegimen.id == 0 && vm.entry.theCase.onArv, 'text-muted mutter' : !vm.entry.theCase.currentArvRegimen || vm.entry.theCase.currentArvRegimen.id > 0 || !vm.entry.theCase.onArv}">Ghi rõ tên phác đồ thuốc ARV</label>
                                                <input type="text" regimen-input="" class="form-control" placeholder="Nhập tên phác đồ" ng-readonly="!vm.entry.theCase.currentArvRegimen || vm.entry.theCase.currentArvRegimen.id > 0 || !vm.entry.theCase.onArv || !vm.entry.theCase.arvDataEditable" ng-model="vm.entry.theCase.currentArvRegimenName" id="vm.entry.theCase.currentArvRegimenName" />
                                            </div>
                                            <div class="col-lg-3 col-sm-6  margin-top-20">
                                                <label ng-class="{'bold' : vm.entry.theCase.currentArvRegimen && vm.entry.theCase.currentArvRegimen.id == 0 && vm.entry.theCase.onArv, 'text-muted mutter' : !vm.entry.theCase.currentArvRegimen || vm.entry.theCase.currentArvRegimen.id > 0 || !vm.entry.theCase.onArv}">Bậc phác đồ thuốc ARV</label>
                                                <input type="number" ng-readonly="!vm.entry.theCase.currentArvRegimen || vm.entry.theCase.currentArvRegimen.id > 0 || !vm.entry.theCase.onArv || !vm.entry.theCase.arvDataEditable" class="form-control" ng-model="vm.entry.theCase.currentArvRegimenLine" id="vm.entry.theCase.currentArvRegimenLine" />
                                            </div>
                                            <div class="col-lg-3 col-sm-6  margin-top-20">
                                                <label class="bold" ng-class="{'text-muted mutter' : vm.entry.notOnArv}">Ngày bắt đầu phác đồ</label>
                                                <span ng-if="!vm.entry.theCase.onArv || !vm.entry.theCase.arvDataEditable" class="form-control read-only-bg">{{vm.entry.theCase.currentArvRegimenStartDate ? (vm.entry.theCase.currentArvRegimenStartDate | date:'dd/MM/yyyy') : ''}}</span>
                                                <input ng-if="vm.entry.theCase.onArv && vm.entry.theCase.arvDataEditable" id="vm.entry.theCase.currentArvRegimenStartDate" class="form-control" placeholder="Chọn ngày..."
                                                       ng-flatpickr
                                                       fp-opts="vm.datepicker5.dateOpts"
                                                       fp-on-setup="vm.datepicker5.datePostSetup(fpItem)"
                                                       ng-model="vm.entry.theCase.currentArvRegimenStartDate"
                                                       data-enabletime="false" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-12 margin-top-20">
                                                <div class="underline-alt padding-bottom-5 bold">
                                                    <i class="fa fa-caret-down margin-right-5"></i>Đợt điều trị gần đây nhất tại <span class="badge badge-primary font-weight-500">{{vm.entry.organization.name}}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-3 col-md-6 col-sm-6 col-xs-12 margin-top-20 fixed-height-58px">
                                                <label class="bold">Loại hình đăng ký</label>
                                                <span ng-if="vm.entry.id" class="form-control read-only-bg">{{vm.entry.enrollmentType | enrollmentType}}</span>
                                                <ui-select ng-if="!vm.entry.id" id="vm.entry.theCase.enrollmentType" ng-model="vm.entry.enrollmentType" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                    <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                                    <ui-select-choices repeat="et.id as et in vm.enrollmentTypes | propsFilter: {name: $select.search}">
                                                        <div class="bold" ng-bind-html="et.name | highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px" >
                                                <label class="bold">Mã bệnh án tại cơ sở này</label>
                                                <input type="text" upper-case="" ng-readonly="vm.entry.id" class="form-control" ng-model="vm.entry.patientChartId" id="vm.entry.patientChartId" />
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px" >
                                                <label class="bold">Ngày bắt đầu đợt điều trị</label>
                                                <span ng-if="vm.entry.id" class="form-control read-only-bg">{{vm.entry.startDate | date:'dd/MM/yyyy'}}</span>
                                                <input id="vm.entry.startDateAtCurrentOPC" ng-if="!vm.entry.id" class="form-control" placeholder="Chọn ngày..."
                                                       ng-flatpickr
                                                       fp-opts="vm.datepicker7.dateOpts"
                                                       fp-on-setup="vm.datepicker7.datePostSetup(fpItem)"
                                                       ng-model="vm.entry.startDate"
                                                       data-enabletime="false" />
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px" >
                                                <label class="bold">Trạng thái điều trị</label>
                                                <span ng-if="vm.entry.id" class="form-control read-only-bg">{{vm.entry.status | patientStatus}}</span>
                                                <ui-select ng-if="!vm.entry.id" id="vm.entry.latestStatus" ng-model="vm.entry.status" sortable="true" close-on-select="true" style="width: 100%!important;">
                                                    <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                                    <ui-select-choices repeat="stat.id as stat in vm.patientStatuses | propsFilter: {name: $select.search}">
                                                        <div class="bold" ng-bind-html="stat.name | highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select>
                                            </div>
                                            <div class="col-lg-3 col-md-6 col-sm-6 margin-top-20 fixed-height-58px" ng-if="vm.entry.status && vm.entry.status && vm.entry.status != 'ACTIVE'">
                                                <label ng-class="{'font-weight-500' : vm.entry.status == 'ACTIVE', 'bold' : vm.entry.status != 'ACTIVE'}">Ngày kết thúc đợt điều trị</label>
                                                <span ng-if="vm.entry.id" class="form-control read-only-bg">{{vm.entry.endDate | date:'dd/MM/yyyy'}}</span>
                                                <input ng-if="!vm.entry.id" id="vm.entry.endDateAtCurrentOPC" class="form-control" placeholder="Chọn ngày..."
                                                       ng-flatpickr
                                                       fp-opts="vm.datepicker4.dateOpts"
                                                       fp-on-setup="vm.datepicker4.datePostSetup(fpItem)"
                                                       ng-model="vm.entry.endDate"
                                                       data-enabletime="false" />
                                            </div>
                                        </div>
                                        <div class="section-head with-background-1 bold"><i class="im im-icon-Note color-7"></i> Ghi chú thêm về bệnh nhân này</div>
                                        <textarea class="form-control dashed-border" placeholder="Nội dung thông tin ghi chú..." data-ng-model="vm.entry.note" textarea-autogrow="" rows="3" style="resize: none;"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- END MAIN CONTENT -->
<div ng-include="'_treatment/views/fragments/_general_error.html?v=' + settings.versionNumber"></div>
<div ng-include="'_treatment/views/fragments/_noneditable_alert.html?v=' + settings.versionNumber"></div>
<div ng-include="'_treatment/views/fragments/_confirmation.html?v=' + settings.versionNumber"></div>
<div ng-include="'_treatment/views/fragments/_record_found_confirmation.html?v=' + settings.versionNumber"></div>
<div ng-include="'_treatment/views/fragments/_information.html?v=' + settings.versionNumber"></div>
<div ng-include="'_treatment/views/fragments/_input.html?v=' + settings.versionNumber"></div>