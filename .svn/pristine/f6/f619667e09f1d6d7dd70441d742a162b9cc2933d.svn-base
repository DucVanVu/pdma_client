<!-- BEGIN PAGE HEADER-->
<div class="page-bar">
    <h3 class="page-title pull-left"><i class="icon-pencil"></i> Ghi nhận tình huống không mong muốn</h3>
    <ul class="page-breadcrumb pull-right hidden-xs">
        <li>
            <a href="#">Trang chủ</a>
            <i class="fa fa-circle"></i>
        </li>
        <li>
            <a href="#/pns-ae">Báo cáo tình huống</a>
        </li>
    </ul>
</div>
<!-- END PAGE HEADER-->
<!-- BEGIN MAIN CONTENT -->
<div class="row margin-top-10">
    <div class="col-md-12">
        <div class="portlet light bordered">
            <div class="portlet-body">
                <div class="display-block no-content1 margin-top-10" ng-if="isAdministrator(currentUser)">
                    Bạn không có quyền truy cập nội dung này.
                </div>
                <div ng-if="!isAdministrator(currentUser)">
                    <div class="opc-toolbar margin-top-10 margin-bottom-10 sticky-panel" hl-sticky="" sticky-class="is-sticky custom-alt-2 padding-left-20" >
                        <button ng-click="vm.saveEntry()" class="btn btn-primary no-border" data-ng-disabled="vm.entry.locked" ng-if="isSiteManager(currentUser)"><i class="fa fa-download margin-right-10"></i><span class="hidden-xs"> Lưu báo cáo</span></button>
                        <div class="vertical-seperator float-right" ng-if="isSiteManager(currentUser)"></div>
                        <button ng-click="vm.submitEntry()" class="btn btn-default no-border" data-ng-disabled="vm.entry.locked || !vm.entry.id" ng-if="isSiteManager(currentUser)"><i class="fa fa-paper-plane-o margin-right-10"></i><span class="hidden-xs"> Gửi báo cáo lên tuyến trên</span></button>
                        <div class="vertical-seperator float-right" ng-if="isSiteManager(currentUser)"></div>
                        <a class="btn btn-default no-border" href="#/pns-ae"><i class="fa fa-long-arrow-left margin-right-10"></i><span class="hidden-xs"> Quay lại</span></a>
                    </div>
                    <div class="info-box-alt"><span class="header"><i class="im im-icon-Idea-2"></i> Hướng dẫn</span>
                        <p>Cán bộ tại cơ sở sử dụng <span class="italic">Phiếu dành cho tư vấn viên báo cáo tình huống không mong muốn liên quan đến TBXNBT/BC</span> và <span class="italic">Phiếu điều tra tình huống không mong muốn của dịch vụ TBXNBT/BC</span> để nhập thông tin vào biểu dưới đây.</p>
                    </div>
                    <div class="grid-2-col">
                        <div class="grid-body">
                            <div class="first-child">
                                <div class="font-weight-600">1.1. Tên cơ sở cung cấp dịch vụ</div>
                                <div>
                                    <ui-select id="vm.entry.facility" ng-model="vm.entry.facility" sortable="true" close-on-select="true" style="width: 90%!important;">
                                        <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                        <ui-select-choices repeat="f in vm.orgsWritable | filter: {name: $select.search}">
                                            <div class="bold" ng-bind-html="f.name | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">1.2. Loại hình cơ sở</div>
                                <div>
                                    <ui-select id="vm.entry.facilityType" ng-model="vm.entry.facilityType" sortable="true" close-on-select="true" style="width: 90%!important;">
                                        <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                        <ui-select-choices repeat="f.id as f in vm.facilityTypes | filter: {name: $select.search}">
                                            <div class="bold" ng-bind-html="f.name | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">2.1. Tuổi của người có HIV</div>
                                <div>
                                    <input id="vm.entry.age" type="text" class="form-control" placeholder="Vui lòng nhập tuổi..." input-mask="99" ng-model="vm.entry.age" />
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">2.2. Giới tính của người có HIV</div>
                                <div>
                                    <ui-select id="vm.entry.gender" ng-model="vm.entry.gender" sortable="true" close-on-select="true" style="width: 90%!important;">
                                        <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                        <ui-select-choices repeat="f.id as f in vm.genders | filter: {name: $select.search}">
                                            <div class="bold" ng-bind-html="f.name | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">2.3. Phân nhóm người có HIV</div>
                                <div>
                                    <ui-select id="vm.entry.group" ng-model="vm.entry.group" sortable="true" close-on-select="true" style="width: 90%!important;">
                                        <ui-select-match allow-clear="false" placeholder="Xin mời chọn...">{{$select.selected.name}}</ui-select-match>
                                        <ui-select-choices repeat="f.id as f in vm.clientTypes | filter: {name: $select.search}">
                                            <div class="bold" ng-bind-html="f.name | highlight: $select.search"></div>
                                        </ui-select-choices>
                                    </ui-select>
                                </div>
                            </div>
                            <div ng-if="vm.entry.group == 4">
                                <div class="font-weight-600">2.4. Vui lòng mô tả phân nhóm của người có HIV</div>
                                <div>
                                    <input id="vm.entry.groupText" type="text" class="form-control" ng-model="vm.entry.groupText" />
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">3.1. Ngày và thời điểm xảy ra tình huống không mong muốn</div>
                                <div>
                                    <input id="vm.entry.reportDate" class="form-control" placeholder="Cho biết ngày và thời điểm xảy ra tình huống..."
                                           ng-flatpickr
                                           fp-opts="vm.datepicker1.dateOpts"
                                           fp-on-setup="vm.datepicker1.datePostSetup(fpItem)"
                                           ng-model="vm.entry.reportDate"
                                           data-enabletime="true" />
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">3.2. Tình huống của người có HIV là gì?</div>
                                <div id="vm.entry.eventType">
                                    <div class="md-radio-inline" ng-repeat="opt in vm.eventTypes" style="margin-top: 20px !important;">
                                        <div class="md-radio">
                                            <input type="radio" id="radio_event_type_{{opt.id}}" ng-change="vm.convertValue2Numeric('eventType')" name="radio_event_type" ng-model="vm.entry.eventType" ng-value="opt.id" class="md-radiobtn">
                                            <label for="radio_event_type_{{opt.id}}">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span> {{opt.name}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">3.3. Tình huống không mong muốn này có làm khách hàng bị tổn hại danh dự, tổn hại tâm lý, vi phạm quy tắc bảo mật hoặc bị xử lý hình sự, v.v… không?</div>
                                <div id="vm.entry.hurt">
                                    <div class="md-radio-inline" ng-repeat="opt in vm.yesNo" style="margin-top: 20px !important;">
                                        <div class="md-radio">
                                            <input type="radio" id="radio_hurt_{{opt.id}}" ng-change="vm.convertValue2Numeric('hurt')" name="radio_hurt" ng-model="vm.entry.hurt" ng-value="opt.id" class="md-radiobtn">
                                            <label for="radio_hurt_{{opt.id}}">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span> {{opt.name}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">3.4. Nguyên nhân trực tiếp của tình huống không mong muốn đó có phải là do tham gia TBXN BT/BC không?</div>
                                <div id="vm.entry.pnsRootCause">
                                    <div class="md-radio-inline" ng-repeat="opt in vm.yesMaybeNo" style="margin-top: 20px !important;">
                                        <div class="md-radio">
                                            <input type="radio" id="radio_pnsrootcause_{{opt.id}}" ng-change="vm.convertValue2Numeric('pnsRootCause')" name="radio_pns_root_cause" ng-model="vm.entry.pnsRootCause" ng-value="opt.id" class="md-radiobtn">
                                            <label for="radio_pnsrootcause_{{opt.id}}">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span> {{opt.name}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">3.5. Có bất kỳ hành động nào để ứng phó lập tức với tình huống không mong muốn không? Ví dụ: khách hàng có được chuyển gửi đến các dịch vụ hỗ trợ (pháp lý, y tế, xã hội, tư vấn…) không?</div>
                                <div id="vm.entry.actionTaken">
                                    <div class="md-radio-inline" ng-repeat="opt in vm.yesNo" style="margin-top: 20px !important;">
                                        <div class="md-radio">
                                            <input type="radio" id="radio_actiontaken_{{opt.id}}" ng-change="vm.convertValue2Numeric('actionTaken')" name="radio_actiontaken" ng-model="vm.entry.actionTaken" ng-value="opt.id" class="md-radiobtn">
                                            <label for="radio_actiontaken_{{opt.id}}">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span> {{opt.name}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">4.1. Cơ sở có tiến hành điều tra tình huống không mong muốn không?</div>
                                <div id="vm.entry.investigated">
                                    <div class="md-radio-inline" ng-repeat="opt in vm.yesNo" style="margin-top: 20px !important;">
                                        <div class="md-radio">
                                            <input type="radio" id="radio_investigated_{{opt.id}}" ng-change="vm.convertValue2Numeric('investigated')" name="radio_investigated" ng-model="vm.entry.investigated" ng-value="opt.id" class="md-radiobtn">
                                            <label for="radio_investigated_{{opt.id}}">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span> {{opt.name}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div ng-if="vm.entry.investigated == 1">
                                <div class="font-weight-600">4.2. Ngày thực hiện điều tra tình huống không mong muốn</div>
                                <div>
                                    <input id="vm.entry.investigateDate" class="form-control" placeholder="Cho biết ngày điều tra..."
                                           ng-flatpickr
                                           fp-opts="vm.datepicker2.dateOpts"
                                           fp-on-setup="vm.datepicker2.datePostSetup(fpItem)"
                                           ng-model="vm.entry.investigateDate"
                                           data-enabletime="false" />
                                </div>
                            </div>
                            <div>
                                <div class="font-weight-600">4.3. Cơ sở có thảo luận tìm giải pháp không?</div>
                                <div id="vm.entry.discussed">
                                    <div class="md-radio-inline" ng-repeat="opt in vm.yesNo" style="margin-top: 20px !important;">
                                        <div class="md-radio">
                                            <input type="radio" id="radio_discussed_{{opt.id}}" ng-change="vm.convertValue2Numeric('discussed')" name="radio_discussed" ng-model="vm.entry.discussed" ng-value="opt.id" class="md-radiobtn">
                                            <label for="radio_discussed_{{opt.id}}">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span> {{opt.name}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div ng-class="{'padding-bottom-30' : vm.entry.addressed != 1}">
                                <div class="font-weight-600">4.4. Tình huống không mong muốn có được xử trí không?</div>
                                <div id="vm.entry.addressed">
                                    <div class="md-radio-inline" ng-repeat="opt in vm.yesNo" style="margin-top: 20px !important;">
                                        <div class="md-radio">
                                            <input type="radio" id="radio_addressed_{{opt.id}}" ng-change="vm.convertValue2Numeric('addressed')" name="radio_addressed" ng-model="vm.entry.addressed" ng-value="opt.id" class="md-radiobtn">
                                            <label for="radio_addressed_{{opt.id}}">
                                                <span></span>
                                                <span class="check"></span>
                                                <span class="box"></span> {{opt.name}}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="padding-bottom-30" ng-if="vm.entry.addressed == 1">
                                <div class="font-weight-600">4.5. Tình huống được xử trí vào ngày nào?</div>
                                <div>
                                    <input id="vm.entry.addressDate" class="form-control" placeholder="Cho biết ngày xử trí..."
                                           ng-flatpickr
                                           fp-opts="vm.datepicker3.dateOpts"
                                           fp-on-setup="vm.datepicker3.datePostSetup(fpItem)"
                                           ng-model="vm.entry.addressDate"
                                           data-enabletime="false" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END MAIN CONTENT -->
<!-- BEGIN MAIN JS-->
<script type="text/ng-template" id="submit_entry_modal.html">
    <div modal-movable auto-height="yes">
        <div class="modal-header">
            <button type="button" class="close" ng-click="$dismiss()" aria-hidden="true"></button>
            <h4 class="modal-title"><i class="fa fa-paper-plane-o"></i> Gửi báo cáo</h4>
        </div>
        <div class="modal-body has-icon">
            <div><i class="icon-exclamation"></i></div>
            <div><span>Bạn sẽ không tiếp tục sửa được các nội dung của báo cáo sau khi bạn gửi lên tuyến trên. Bạn có chắc chắn muốn gửi không?
            </span></div>
        </div>
        <div class="modal-footer">
            <button type="button" ng-click="$dismiss()" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close margin-right-10"></i>Không</button>
            <button type="button" ng-click="$close('yes')" class="btn btn-primary no-border" data-dismiss="modal"><i class="fa fa-check margin-right-10"></i>Có</button>
        </div>
    </div>
</script>
<!-- BEGIN MAIN JS -->